<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIYALA - الإشعارات</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* ===== CSS RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* نظام الألوان */
            --bg-primary: #0C0F17;
            --bg-secondary: #121522;
            --bg-card: rgba(255, 255, 255, 0.03);
            --text-primary: #E6E6E6;
            --text-secondary: rgba(230, 230, 230, 0.6);
            --text-muted: rgba(230, 230, 230, 0.4);
            --accent-primary: #FF6D1F;
            --accent-hover: #FF8B4A;
            --status-success: #76DE68;
            --status-warning: #FFB347;
            --status-danger: #ED3F27;
            --status-info: #4A90E2;

            /* Borders */
            --border-light: rgba(255, 255, 255, 0.06);
            --border-medium: rgba(255, 255, 255, 0.1);
            --border-accent: rgba(255, 109, 31, 0.3);

            /* Shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.16);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);

            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;

            /* Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 999px;

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;
        }

        /* ===== BASE TYPOGRAPHY ===== */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            font-size: 14px;
            font-weight: 400;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== NAVBAR ===== */
        .seller-navbar {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: 0 var(--space-lg);
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .seller-navbar {
                padding: 0 var(--space-md);
                height: 56px;
            }
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 700;
            font-size: 18px;
            color: var(--accent-primary);
            text-decoration: none;
        }

        .nav-brand i {
            font-size: 24px;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-normal);
            position: relative;
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.06);
            color: var(--text-primary);
            border-color: var(--border-medium);
        }

        /* ===== MAIN LAYOUT ===== */
        .notifications-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        @media (max-width: 768px) {
            .notifications-container {
                padding: var(--space-md);
            }
        }

        /* ===== PAGE HEADER ===== */
        .page-header {
            margin-bottom: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid var(--border-light);
        }

        .page-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg,
                    rgba(255, 109, 31, 0.1),
                    rgba(74, 144, 226, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-primary);
            font-size: 28px;
        }

        .page-title h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: var(--space-xs);
            color: var(--text-primary);
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .notification-count {
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding: 2px 10px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            margin-right: var(--space-sm);
        }

        /* ===== NOTIFICATIONS CONTROLS ===== */
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        @media (max-width: 768px) {
            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .filters {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.03);
            border-color: var(--border-medium);
        }

        .filter-btn.active {
            background: rgba(255, 109, 31, 0.1);
            color: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .action-buttons {
            display: flex;
            gap: var(--space-sm);
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .btn-danger {
            background: var(--status-danger);
            color: white;
        }

        .btn-danger:hover {
            background: #FF5252;
        }

        /* ===== NOTIFICATIONS LIST ===== */
        .notifications-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .notification-item {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            transition: all var(--transition-normal);
            cursor: pointer;
            position: relative;
        }

        .notification-item:hover {
            border-color: var(--border-medium);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .notification-item.unread {
            background: rgba(74, 144, 226, 0.05);
            border-color: rgba(74, 144, 226, 0.2);
        }

        .notification-item.unread::before {
            content: '';
            position: absolute;
            right: var(--space-md);
            top: var(--space-md);
            width: 8px;
            height: 8px;
            background: var(--status-info);
            border-radius: 50%;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .icon-order {
            background: rgba(255, 109, 31, 0.1);
            color: var(--accent-primary);
        }

        .icon-complaint {
            background: rgba(237, 63, 39, 0.1);
            color: var(--status-danger);
        }

        .icon-review {
            background: rgba(255, 179, 71, 0.1);
            color: var(--status-warning);
        }

        .icon-system {
            background: rgba(118, 222, 104, 0.1);
            color: var(--status-success);
        }

        .icon-report {
            background: rgba(74, 144, 226, 0.1);
            color: var(--status-info);
        }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: var(--space-xs);
        }

        .notification-meta {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 12px;
            color: var(--text-muted);
        }

        .notification-time {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .notification-actions {
            display: flex;
            gap: var(--space-xs);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .notification-item:hover .notification-actions {
            opacity: 1;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: var(--space-2xl) var(--space-lg);
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-lg);
            background: linear-gradient(135deg,
                    rgba(255, 109, 31, 0.1),
                    rgba(74, 144, 226, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-primary);
            font-size: 36px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
        }

        .empty-message {
            color: var(--text-secondary);
            font-size: 14px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ===== PAGINATION ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            margin-top: var(--space-xl);
        }

        .pagination-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .pagination-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--border-medium);
        }

        .pagination-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: var(--bg-primary);
        }

        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== LOADING ===== */
        .loading {
            display: flex;
            justify-content: center;
            padding: var(--space-2xl);
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .notification-item {
                flex-direction: column;
                gap: var(--space-md);
            }

            .notification-actions {
                align-self: flex-end;
                opacity: 1;
            }

            .notification-meta {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .notification-item {
                padding: var(--space-md);
            }

            .notification-title {
                font-size: 13px;
            }

            .notification-message {
                font-size: 12px;
            }
        }

        /* ===== NOTIFICATIONS DROPDOWN ===== */
        .notifications-dropdown {
            position: fixed;
            top: 70px;
            right: var(--space-lg);
            width: 380px;
            max-width: 90vw;
            max-height: 70vh;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notifications-dropdown.active {
            display: flex;
        }

        .dropdown-header {
            padding: var(--space-md);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-header h3 {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .dropdown-header .btn-link {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
        }

        .dropdown-list {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .dropdown-footer {
            padding: var(--space-md);
            border-top: 1px solid var(--border-light);
            text-align: center;
        }

        /* ===== TOAST SYSTEM ===== */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            pointer-events: none;
            width: 90%;
            max-width: 400px;
        }

        .toast {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--space-md) var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            box-shadow: var(--shadow-md);
            animation: toastIn 0.3s ease forwards;
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast-success::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--status-success);
        }

        .toast-error::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--status-danger);
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="seller-navbar">
        <a href="dashboard.html" class="nav-brand">
            <i class="fas fa-bell"></i>
            <span>الإشعارات</span>
        </a>

        <div class="nav-actions">
            <button class="btn-icon" id="backBtn" title="رجوع">
                <i class="fas fa-arrow-right"></i>
            </button>

            <button class="btn-icon" id="notificationsBtn" title="الإشعارات">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationCount">5</span>
            </button>

            <button class="btn-icon" id="settingsBtn" title="الإعدادات">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </nav>

    <!-- Notifications Dropdown -->
    <div class="notifications-dropdown" id="notificationsDropdown">
        <div class="dropdown-header">
            <h3>
                <i class="fas fa-bell"></i>
                الإشعارات الحديثة
                <span class="notification-count">5</span>
            </h3>
            <a href="notifications.html" class="btn-link">عرض الكل</a>
        </div>
        <div class="dropdown-list" id="dropdownList">
            <!-- سيتم ملؤها بواسطة JavaScript -->
        </div>
        <div class="dropdown-footer">
            <button class="btn btn-secondary" id="markAllRead" style="width: 100%;">
                <i class="fas fa-check-double"></i>
                تعيين الكل كمقروء
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <main class="notifications-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-icon">
                <i class="fas fa-bell"></i>
            </div>
            <div class="page-title">
                <h1>
                    الإشعارات
                    <span class="notification-count" id="totalNotifications">15</span>
                </h1>
                <p class="page-subtitle">تابع كل نشاطات متجرك وطلبات العملاء</p>
            </div>
        </div>

        <!-- Controls Bar -->
        <div class="controls-bar">
            <div class="filters">
                <button class="filter-btn active" data-filter="all">
                    <i class="fas fa-layer-group"></i>
                    الكل
                </button>
                <button class="filter-btn" data-filter="unread">
                    <i class="fas fa-circle"></i>
                    غير مقروء
                </button>
                <button class="filter-btn" data-filter="order">
                    <i class="fas fa-shopping-bag"></i>
                    الطلبات
                </button>
                <button class="filter-btn" data-filter="complaint">
                    <i class="fas fa-exclamation-triangle"></i>
                    الشكاوى
                </button>
                <button class="filter-btn" data-filter="review">
                    <i class="fas fa-star"></i>
                    التقييمات
                </button>
                <button class="filter-btn" data-filter="system">
                    <i class="fas fa-cogs"></i>
                    النظام
                </button>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" id="refreshBtn">
                    <i class="fas fa-redo"></i>
                    تحديث
                </button>
                <button class="btn btn-secondary" id="markAllAsRead">
                    <i class="fas fa-check-double"></i>
                    تعيين الكل كمقروء
                </button>
                <button class="btn btn-danger" id="deleteAllBtn">
                    <i class="fas fa-trash"></i>
                    حذف الكل
                </button>
            </div>
        </div>

        <!-- Notifications List -->
        <div class="notifications-list" id="notificationsList">
            <!-- سيتم ملؤها بواسطة JavaScript -->
        </div>

        <!-- Loading State -->
        <div class="loading" id="loadingState">
            <div class="loader"></div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">
                <i class="far fa-bell-slash"></i>
            </div>
            <h3 class="empty-title">لا توجد إشعارات</h3>
            <p class="empty-message">لم تتلق أي إشعارات بعد. ستظهر هنا عند استلام طلبات جديدة أو تحديثات مهمة.</p>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <!-- سيتم ملؤها بواسطة JavaScript -->
        </div>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- JavaScript -->
    <script>
        // ===== بيانات تجريبية للإشعارات =====
        const notificationsData = {
            total: 15,
            unread: 5,
            notifications: [
                {
                    id: 1,
                    type: 'order',
                    title: 'طلب جديد',
                    message: 'أحمد محمد قام بشراء تيشيرت قطني - اللون أسود، المقاس XL',
                    time: 'منذ 5 دقائق',
                    timestamp: new Date(Date.now() - 5 * 60000),
                    isRead: false,
                    orderId: 'ORD-001',
                    customerName: 'أحمد محمد',
                    amount: 450
                },
                {
                    id: 2,
                    type: 'complaint',
                    title: 'شكوى جديدة',
                    message: 'مشكلة في الشحن - تأخر تسليم الطلب رقم ORD-098',
                    time: 'منذ ساعة',
                    timestamp: new Date(Date.now() - 60 * 60000),
                    isRead: false,
                    complaintId: 'COMP-001',
                    orderId: 'ORD-098',
                    status: 'open'
                },
                {
                    id: 3,
                    type: 'review',
                    title: 'تقييم جديد',
                    message: 'سارة علي قامت بتقييم منتج "تيشيرت قطني" بـ 4 نجوم',
                    time: 'منذ 3 ساعات',
                    timestamp: new Date(Date.now() - 3 * 60 * 60000),
                    isRead: true,
                    productId: 'PROD-001',
                    rating: 4,
                    customerName: 'سارة علي'
                },
                {
                    id: 4,
                    type: 'system',
                    title: 'تقرير يومي',
                    message: 'إجمالي مبيعات اليوم: EGP 1,250 - 5 طلبات جديدة',
                    time: 'منذ 6 ساعات',
                    timestamp: new Date(Date.now() - 6 * 60 * 60000),
                    isRead: false,
                    reportType: 'daily',
                    sales: 1250,
                    orders: 5
                },
                {
                    id: 5,
                    type: 'order',
                    title: 'تحديث حالة الطلب',
                    message: 'تم تسليم الطلب رقم ORD-095 إلى العميل محمد حسن',
                    time: 'منذ 12 ساعة',
                    timestamp: new Date(Date.now() - 12 * 60 * 60000),
                    isRead: true,
                    orderId: 'ORD-095',
                    status: 'delivered',
                    customerName: 'محمد حسن'
                },
                {
                    id: 6,
                    type: 'complaint',
                    title: 'شكوى تم حلها',
                    message: 'تم حل شكوى رقم COMP-045 - استبدال المنتج',
                    time: 'منذ يوم',
                    timestamp: new Date(Date.now() - 24 * 60 * 60000),
                    isRead: true,
                    complaintId: 'COMP-045',
                    status: 'resolved',
                    resolution: 'product_replacement'
                },
                {
                    id: 7,
                    type: 'review',
                    title: 'تقييم سلبي',
                    message: 'عمر خالد قام بتقييم منتج "جاكيت شتوي" بـ 2 نجوم',
                    time: 'منذ يومين',
                    timestamp: new Date(Date.now() - 2 * 24 * 60 * 60000),
                    isRead: false,
                    productId: 'PROD-002',
                    rating: 2,
                    customerName: 'عمر خالد'
                },
                {
                    id: 8,
                    type: 'system',
                    title: 'تحديث النظام',
                    message: 'تم تحديث نظام المدفوعات - إضافة فودافون كاش',
                    time: 'منذ 3 أيام',
                    timestamp: new Date(Date.now() - 3 * 24 * 60 * 60000),
                    isRead: true,
                    updateType: 'payment',
                    features: ['vodafone_cash']
                }
            ]
        };

        // ===== حالة التطبيق =====
        let appState = {
            currentFilter: 'all',
            currentPage: 1,
            itemsPerPage: 8,
            notifications: [...notificationsData.notifications],
            selectedNotifications: new Set()
        };

        // ===== النظام الرئيسي =====
        class NotificationsSystem {
            constructor() {
                this.initialize();
            }

            initialize() {
                this.renderNotifications();
                this.setupEventListeners();
                this.updateStats();
                this.showToast('تم تحميل الإشعارات بنجاح', 'success');
            }

            renderNotifications() {
                const list = document.getElementById('notificationsList');
                const emptyState = document.getElementById('emptyState');
                const loadingState = document.getElementById('loadingState');
                const pagination = document.getElementById('pagination');

                // إخفاء حالة التحميل
                loadingState.style.display = 'none';

                // تصفية الإشعارات
                let filtered = this.filterNotifications();

                if (filtered.length === 0) {
                    list.style.display = 'none';
                    emptyState.style.display = 'block';
                    pagination.style.display = 'none';
                    return;
                }

                list.style.display = 'flex';
                emptyState.style.display = 'none';
                pagination.style.display = 'flex';

                // حساب الصفحات
                const totalPages = Math.ceil(filtered.length / appState.itemsPerPage);
                const start = (appState.currentPage - 1) * appState.itemsPerPage;
                const end = start + appState.itemsPerPage;
                const pageNotifications = filtered.slice(start, end);

                // عرض الإشعارات
                list.innerHTML = pageNotifications.map(notification => this.createNotificationHTML(notification)).join('');

                // عرض الترقيم
                this.renderPagination(totalPages);

                // تحديث القائمة المنسدلة
                this.updateDropdown();
            }

            filterNotifications() {
                const { currentFilter, notifications } = appState;

                if (currentFilter === 'all') {
                    return notifications;
                }

                if (currentFilter === 'unread') {
                    return notifications.filter(n => !n.isRead);
                }

                return notifications.filter(n => n.type === currentFilter);
            }

            createNotificationHTML(notification) {
                const iconClass = `icon-${notification.type}`;
                const icons = {
                    order: 'fas fa-shopping-bag',
                    complaint: 'fas fa-exclamation-triangle',
                    review: 'fas fa-star',
                    system: 'fas fa-cogs',
                    report: 'fas fa-chart-bar'
                };

                return `
                    <div class="notification-item ${notification.isRead ? '' : 'unread'}" 
                         data-id="${notification.id}"
                         onclick="notificationsSystem.handleNotificationClick(${notification.id})">
                        <div class="notification-icon ${iconClass}">
                            <i class="${icons[notification.type] || 'fas fa-bell'}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">
                                ${notification.title}
                                ${notification.isRead ? '' : '<span class="notification-badge">جديد</span>'}
                            </div>
                            <p class="notification-message">${notification.message}</p>
                            <div class="notification-meta">
                                <span class="notification-time">
                                    <i class="far fa-clock"></i>
                                    ${notification.time}
                                </span>
                            </div>
                        </div>
                        <div class="notification-actions">
                            <button class="action-btn" onclick="notificationsSystem.toggleRead(${notification.id}, event)">
                                <i class="fas ${notification.isRead ? 'fa-envelope' : 'fa-envelope-open'}"></i>
                            </button>
                            <button class="action-btn" onclick="notificationsSystem.deleteNotification(${notification.id}, event)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }

            renderPagination(totalPages) {
                const pagination = document.getElementById('pagination');

                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }

                let html = `
                    <button class="pagination-btn ${appState.currentPage === 1 ? 'disabled' : ''}" 
                            onclick="notificationsSystem.changePage(${appState.currentPage - 1})">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                `;

                for (let i = 1; i <= totalPages; i++) {
                    html += `
                        <button class="pagination-btn ${appState.currentPage === i ? 'active' : ''}" 
                                onclick="notificationsSystem.changePage(${i})">
                            ${i}
                        </button>
                    `;
                }

                html += `
                    <button class="pagination-btn ${appState.currentPage === totalPages ? 'disabled' : ''}" 
                            onclick="notificationsSystem.changePage(${appState.currentPage + 1})">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                `;

                pagination.innerHTML = html;
            }

            updateDropdown() {
                const dropdownList = document.getElementById('dropdownList');
                const unreadNotifications = appState.notifications.filter(n => !n.isRead).slice(0, 5);

                dropdownList.innerHTML = unreadNotifications.map(notification => `
                    <div class="notification-item unread" onclick="notificationsSystem.handleNotificationClick(${notification.id})">
                        <div class="notification-icon icon-${notification.type}">
                            <i class="${notification.type === 'order' ? 'fas fa-shopping-bag' :
                        notification.type === 'complaint' ? 'fas fa-exclamation-triangle' :
                            notification.type === 'review' ? 'fas fa-star' : 'fas fa-cogs'}"></i>
                        </div>
                        <div class="notification-content">
                            <div class="notification-title">${notification.title}</div>
                            <p class="notification-message">${notification.message}</p>
                        </div>
                    </div>
                `).join('');
            }

            updateStats() {
                const total = appState.notifications.length;
                const unread = appState.notifications.filter(n => !n.isRead).length;

                document.getElementById('totalNotifications').textContent = total;
                document.getElementById('notificationCount').textContent = unread;
                document.querySelector('.notification-count').textContent = unread;
            }

            // ===== Event Handlers =====
            handleNotificationClick(id) {
                const notification = appState.notifications.find(n => n.id === id);
                if (!notification) return;

                // وضع علامة كمقروء
                if (!notification.isRead) {
                    notification.isRead = true;
                    this.renderNotifications();
                    this.updateStats();
                    this.showToast('تم تعيين الإشعار كمقروء', 'success');
                }

                // التنقل حسب نوع الإشعار
                switch (notification.type) {
                    case 'order':
                        window.location.href = `order-details.html?id=${notification.orderId}`;
                        break;
                    case 'complaint':
                        window.location.href = `complaint-details.html?id=${notification.complaintId}`;
                        break;
                    case 'review':
                        window.location.href = `product-details.html?id=${notification.productId}`;
                        break;
                    default:
                        // لا يوجد إجراء
                        break;
                }
            }

            toggleRead(id, event) {
                event.stopPropagation();
                const notification = appState.notifications.find(n => n.id === id);
                if (!notification) return;

                notification.isRead = !notification.isRead;
                this.renderNotifications();
                this.updateStats();

                const action = notification.isRead ? 'مقروء' : 'غير مقروء';
                this.showToast(`تم تعيين الإشعار كـ ${action}`, 'success');
            }

            deleteNotification(id, event) {
                event.stopPropagation();

                if (confirm('هل أنت متأكد من حذف هذا الإشعار؟')) {
                    appState.notifications = appState.notifications.filter(n => n.id !== id);
                    this.renderNotifications();
                    this.updateStats();
                    this.showToast('تم حذف الإشعار بنجاح', 'success');
                }
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filterNotifications().length / appState.itemsPerPage);

                if (page < 1 || page > totalPages) return;

                appState.currentPage = page;
                this.renderNotifications();
            }

            setFilter(filter) {
                appState.currentFilter = filter;
                appState.currentPage = 1;
                this.renderNotifications();

                // تحديد الأزرار النشطة
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.filter === filter);
                });
            }

            markAllAsRead() {
                appState.notifications.forEach(notification => {
                    notification.isRead = true;
                });

                this.renderNotifications();
                this.updateStats();
                this.showToast('تم تعيين جميع الإشعارات كمقروء', 'success');
            }

            deleteAll() {
                if (confirm('هل أنت متأكد من حذف جميع الإشعارات؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                    appState.notifications = [];
                    this.renderNotifications();
                    this.updateStats();
                    this.showToast('تم حذف جميع الإشعارات', 'success');
                }
            }

            refresh() {
                document.getElementById('loadingState').style.display = 'flex';

                // محاكاة تحديث البيانات
                setTimeout(() => {
                    this.renderNotifications();
                    this.updateStats();
                    this.showToast('تم تحديث الإشعارات', 'success');
                }, 1000);
            }

            // ===== Toast System =====
            showToast(message, type = 'success') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;

                const icon = type === 'success' ? '✓' : '✗';
                const iconColor = type === 'success' ? 'var(--status-success)' : 'var(--status-danger)';

                toast.innerHTML = `
                    <div style="color: ${iconColor}; font-weight: bold; font-size: 18px;">${icon}</div>
                    <div style="flex: 1;">${message}</div>
                `;

                container.appendChild(toast);

                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(-10px)';
                    setTimeout(() => container.removeChild(toast), 300);
                }, 3000);
            }

            // ===== Event Listeners Setup =====
            setupEventListeners() {
                // الفلاتر
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.setFilter(btn.dataset.filter);
                    });
                });

                // الأزرار الرئيسية
                document.getElementById('refreshBtn').addEventListener('click', () => this.refresh());
                document.getElementById('markAllAsRead').addEventListener('click', () => this.markAllAsRead());
                document.getElementById('deleteAllBtn').addEventListener('click', () => this.deleteAll());

                // زر الرجوع
                document.getElementById('backBtn').addEventListener('click', () => {
                    window.location.href = 'dashboard.html';
                });

                // زر الإعدادات
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    window.location.href = 'setting.html';
                });

                // القائمة المنسدلة للإشعارات
                document.getElementById('notificationsBtn').addEventListener('click', (e) => {
                    const dropdown = document.getElementById('notificationsDropdown');
                    dropdown.classList.toggle('active');
                    e.stopPropagation();
                });

                // إغلاق القائمة المنسدلة عند النقر خارجها
                document.addEventListener('click', (e) => {
                    const dropdown = document.getElementById('notificationsDropdown');
                    const btn = document.getElementById('notificationsBtn');

                    if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
                        dropdown.classList.remove('active');
                    }
                });

                // تعيين الكل كمقروء في القائمة المنسدلة
                document.getElementById('markAllRead').addEventListener('click', () => {
                    this.markAllAsRead();
                    document.getElementById('notificationsDropdown').classList.remove('active');
                });

                // إغلاق القائمة المنسدلة بزر ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('notificationsDropdown').classList.remove('active');
                    }
                });
            }
        }

        // ===== تهيئة النظام =====
        let notificationsSystem;

        document.addEventListener('DOMContentLoaded', () => {
            notificationsSystem = new NotificationsSystem();
        });

        // ===== وظائف عامة للوصول من HTML =====
        window.toggleDropdown = function () {
            const dropdown = document.getElementById('notificationsDropdown');
            dropdown.classList.toggle('active');
        };

        window.markNotificationAsRead = function (id) {
            notificationsSystem.toggleRead(id);
        };

        window.deleteSingleNotification = function (id) {
            notificationsSystem.deleteNotification(id);
        };
    </script>
</body>

</html>